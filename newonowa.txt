⚠️ FINAL PROMPT ДЛЯ CURSOR
РЕЖИМ РАБОТЫ: FULL REVIEW + DEBUG + IMPLEMENT
СТРОГО ПО README.md И СОГЛАСОВАННОМУ ТЗ

==================================================
ОБЩИЕ ПРАВИЛА (ОБЯЗАТЕЛЬНО ПРОЧИТАТЬ ПЕРВЫМИ)
==================================================

README.md и ранее согласованное ТЗ — ЕДИНСТВЕННЫЙ ИСТОЧНИК ИСТИНЫ.

ПОРЯДОК РАБОТЫ:
1. Прочитать ВЕСЬ код проекта.
2. Понять смысл проекта, экономику и логику бота.
3. Полностью прочитать README.md.
4. Только после этого:
   - фиксить баги
   - добавлять новые игры
   - искать логические ошибки

ТРЕБОВАНИЯ К КОДУ:
- никакой халтуры
- код уровня production
- стабильность важнее скорости
- игрок НИКОГДА не видит проценты, формулы, шансы
- вся математика и вероятности — ТОЛЬКО В ЛОГАХ

==================================================
0. ЧТО ЗАПРЕЩЕНО ТРОГАТЬ
==================================================

- все старые команды и игры ОСТАЮТСЯ
- механики старых игр НЕ переписывать (кроме явных багов)
- экономику не ломать
- стиль сообщений и ответов бота сохранить

==================================================
1. КРИТИЧЕСКИЕ БАГИ (ОБЯЗАТЕЛЬНО ИСПРАВИТЬ)
==================================================

1.1 Команда /freedurev

БАГ:
- команда работает многоразово

НУЖНО:
- сделать строго ОДИН РАЗ на пользователя
- логика как у промокодов из /ref
- при повторном использовании:
  - корректное сообщение
  - без ошибок
  - без начислений

--------------------------------------------------

1.2 Аватарка пользователя

БАГ:
- любая фотография в чате ставится как аватар

НУЖНО:
- аватар меняется ТОЛЬКО через команду /accauntphoto
- любые другие фото игнорировать
- никаких автосрабатываний

--------------------------------------------------

1.3 Комиссии

БАГИ:
- комиссия списывается, даже если команда не выполнилась
- комиссия списывается в командах, где её быть не должно (/accaunt и др.)

НУЖНО:
- комиссия списывается ТОЛЬКО:
  - если команда успешно выполнена
  - только в тех командах, где комиссия предусмотрена
- при ошибке, отмене или сбое — 0 списаний

==================================================
2. КРИТИЧЕСКИЙ БАГ В ИГРЕ /chisla (FIX ONLY)
==================================================

ПРОБЛЕМЫ:
- ломается логика множителей
- возможны зависания
- кнопки остаются активными
- деньги списались, но не начислились
- авто-завершение работает нестабильно

НУЖНО СДЕЛАТЬ (СТРОГО ПО ТЗ):

- корректный вызов: /chisla @user сумма
- проверка баланса у ОБОИХ игроков
- ставка блокируется у обоих до конца игры
- если второй игрок не подтвердил — полный возврат средств

КНОПКИ:
- 6 кнопок
- каждая даёт случайный множитель
- максимальный множитель: x5 (РЕДКО)
- после нажатия:
  - все кнопки отключаются
  - повторное нажатие невозможно

ПОБЕДА:
- у кого множитель выше — тот победил
- победитель получает ВСЮ сумму
- проигравший теряет ставку

ТАЙМЕР:
- игра живёт максимум 5 минут
- если никто не нажал:
  - авто-рандом
  - корректное определение победителя

МЕДИА:
- победителю: winchisla.jpg
- проигравшему: loxchislo.jpg

ПОСЛЕ ЗАВЕРШЕНИЯ:
- сообщение с игрой удаляется

❗ ЗАПРЕЩЕНО:
- добавлять новые фичи в /chisla
- менять концепцию игры

==================================================
3. СИСТЕМА БАНОВ (FIX + /unban)
==================================================

Команда /ban

ХРАНИТЬ В БД:
- user_id
- кто забанил
- причина
- start_time
- end_time
- тип бана (игры / команды)

ПРАВИЛА:
- пользователя @DPOPTH БАНИТЬ ЗАПРЕЩЕНО
- ограничения по ролям соблюдать строго

ПРИ БАНЕ:
- сообщение в чат:
  "Забанил @user на X. Причина: Y"
- отправка картинки ban.jpg
- блокировка всех игровых команд

--------------------------------------------------

Команда /unban

ФОРМАТ:
- /unban @user причина

ДОСТУП:
- создатель — всегда
- админы — только если бан не перманентный

НУЖНО:
- корректно снимать ограничения
- писать лог
- если пользователь не был забанен:
  - корректный ответ
  - без ошибок

==================================================
4. ОБЩИЕ ПРАВИЛА ДЛЯ ВСЕХ ИГР
==================================================

- каждая игра живёт 3 МИНУТЫ
- если пользователь:
  - ничего не нажал
  - проигнорировал игру
→ ВСЕ деньги возвращаются

- если пользователь нажал и:
  - выиграл
  - проиграл
→ игра завершается
→ сообщение удаляется через 20 секунд

==================================================
5. ТИПЫ ИГР
==================================================

5.1 АЗАРТНЫЕ ИГРЫ
- фиксированные проценты
- высокий риск
- как старые игры
- формулы скрыты от игрока

5.2 ЧЕСТНЫЕ ИГРЫ
- начальный шанс победы ~80%
- зависит от суммы ставки:
  - 100 коинов → ~78%
  - 1000 коинов → ~50%
- каждое нажатие:
  - +0.1x … +0.5x (рандом)
- чем выше выигрыш — тем ниже шанс
- визуально ощущается честнее

==================================================
6. НОВЫЕ ИГРЫ (ДОБАВИТЬ)
==================================================

/almaz (честная)
- старт: almaz.jpg
- победа: almazwin.jpg
- проигрыш: almazlox.jpg
- кнопка «Копать»
- каждый шаг увеличивает выигрыш и риск
- можно забрать награду в любой момент

/provod (азартная)
- provod.jpg / provodwin.jpg / provodlox.jpg
- выбрать один провод
- только один правильный

/lift (честная)
- lift.jpg / liftwin.jpg / liftlox.jpg
- каждый этаж = выше риск

/doza (азартная)
- doza.jpg / dozawin.jpg / dozalox.jpg
- кнопка «Ещё»

/shum (честная)
- shum.jpg / shumwin.jpg / shumlox.jpg
- скрытый предел

/kapsula (честная)
- kapsula.jpg / kapsulawin.jpg / kapsulalox.jpg
- таймер ожидания

/signal (честная)
- механика на базе /kripta
- signal.jpg / signalwin.jpg / signallox.jpg

/reaktor (азартная)
- reaktor.jpg / reaktorwin.jpg / reaktorlox.jpg
- управление реактором
- охлаждение снижает риск, но режет множитель
- нагрев повышает риск и множитель
- можно выйти в любой момент

/ten (честная)
- ten.jpg / tenwin.jpg / tenlox.jpg
- движение по коридору
- 2 кнопки: идти дальше / уйти
- дойти до конца = superwin.jpg и x10

/maths (честная)
- maths.jpg / mathswin.jpg / mathslox.jpg
- пример по школьной программе (1–8 класс)
- 3 варианта ответа
- 1 минута на ответ
- победа = x1.5

==================================================
7. ЛОГИ
==================================================

ЛОГИРОВАТЬ:
- победа / поражение
- итоговую сумму
- скрытые шансы
- шаги игрока

ИГРОК:
- НИЧЕГО из этого не видит

==================================================
8. ФИНАЛЬНАЯ ПРОВЕРКА
==================================================

ОБЯЗАТЕЛЬНО:
- пройтись по всему коду
- найти скрытые баги:
  - не удаляющиеся сообщения
  - зависшие кнопки
  - двойные списания (по возможности автопроверка логикой)
- сверить ВСЕ команды с README.md
- /help — только краткие описания

ЗАПРЕЩЕНО:
- показывать закулисье
- объяснять формулы и проценты игроку

ЦЕЛЬ:
- стабильность
- визуал
- логика
⚠️ FINAL PROMPT ДЛЯ CURSOR
РЕЖИМ: FULL REVIEW + DEBUG + IMPLEMENT (СТРОГО ПО ТЗ)
ОБЩЕЕ ПРАВИЛО
README.md + ранее согласованное ТЗ — ИСТОЧНИК ИСТИНЫ
сначала:
ПРОЧИТАТЬ ВЕСЬ КОД
ПОНЯТЬ СМЫСЛ ПРОЕКТА
ПРОЧИТАТЬ README.md
только потом:
фиксить
добавлять игры
искать баги
никакого халтурного кода
код уровня production
игрок НИКОГДА не видит проценты / формулы
вся математика — ТОЛЬКО В ЛОГАХ
=========================
0. ЧТО НЕ ТРОГАТЬ
=========================
все старые игры и команды — ОСТАЮТСЯ
их механики не переписывать (кроме явных багов)
экономику не ломать
стиль ответов бота сохранить
=========================
1. КРИТИЧЕСКИЕ БАГИ (ОБЯЗАТЕЛЬНО FIX)
=========================
1.1 /freedurev
БАГ:
команда не одноразовая
НУЖНО:
сделать строго 1 раз на пользователя
логика как у промокода из /ref
повторное использование → корректный отказ
1.2 Аватарка
БАГ:
любая фотка в чате ставится как аватар
НУЖНО:
аватар меняется ТОЛЬКО через /accauntphoto
любые другие фото игнорировать
1.3 Комиссии
БАГ:
комиссия списывается:
если команда не выполнилась
на командах, где её быть не должно (/accaunt и др.)
НУЖНО:
комиссия списывается ТОЛЬКО:
при УСПЕШНОМ выполнении
только на командах, где она предусмотрена
при ошибке / отмене → 0 списаний
=========================
2. КРИТИЧЕСКИЙ БАГ /chisla (FIX ONLY)
=========================
Проблемы:
неверная логика множителей
зависания
кнопки активны после нажатия
деньги списаны, но не начислены
авто-завершение не всегда работает
Нужно:
строго по ранее согласованному ТЗ:
/chisla @user сумма
проверка баланса у ОБОИХ
ставка блокируется
нет подтверждения → возврат
6 кнопок
max множитель x5 (РЕДКО)
после нажатия:
кнопки отключаются
победитель:
получает ВСЮ сумму
таймер:
5 минут
авто-рандом
медиа:
winchisla.jpg
loxchislo.jpg
после завершения:
сообщение удаляется
❗ НОВЫЕ ФИЧИ В /chisla НЕ ДОБАВЛЯТЬ
=========================
3. БАНЫ (FIX + /unban)
=========================
/ban
хранить в БД:
user_id
кто забанил
причина
start_time
end_time
тип (игры / команды)
@DPOPTH — ЗАПРЕЩЕНО БАНИТЬ
ограничения по ролям
сообщение:
Забанил @user на X. Причина: Y
отправка ban.jpg
блок всех игровых команд
/unban
/unban @user причина
доступ:
создатель — всегда
админы — если не перманент
если не был забанен:
корректный ответ
логирование обязательно
=========================
4. ИГРЫ — ОБЩИЕ ПРАВИЛА
=========================
игры живут 3 МИНУТЫ
если:
пользователь НИЧЕГО не нажал
или проигнорировал → ВСЕ деньги возвращаются
если нажал и:
выиграл
проиграл
→ игра завершается → сообщение удаляется через 20 секунд
=========================
5. ТИПЫ ИГР
=========================
5.1 АЗАРТНЫЕ ИГРЫ
фиксированные проценты
высокий риск
как текущие старые игры
формулы скрыты
5.2 ЧЕСТНЫЕ ИГРЫ
начальный шанс победы: ~80%
зависит от суммы:
100 коинов → ~78%
1000 коинов → ~50%
каждое нажатие:
+0.1x … +0.5x (рандом)
чем выше выигрыш → тем ниже шанс
визуально ощущается «честнее»
=========================
6. НОВЫЕ ИГРЫ (ДОБАВИТЬ)
=========================
6.1 /almaz (честная)
старт: almaz.jpg
победа: almazwin.jpg
проигрыш: almazlox.jpg
кнопка «Копать»
каждый шаг:
↑ выигрыш
↑ риск
можно забрать в любой момент
6.2 /provod (азартная)
provod.jpg / provodwin.jpg / provodlox.jpg
выбрать провод
один правильный
6.3 /lift (честная)
lift.jpg / liftwin.jpg / liftlox.jpg
этажи = риск
6.4 /doza (азартная)
doza.jpg / dozawin.jpg / dozalox.jpg
кнопка «Ещё»
6.5 /shum (честная)
shum.jpg / shumwin.jpg / shumlox.jpg
скрытый предел
6.6 /kapsula (честная)
kapsula.jpg / kapsulawin.jpg / kapsulalox.jpg
таймер ожидания
6.7 /signal (честная) игра где ты ловишь сигнал и в случайный момент ты можешь его потерять что то на базе /kripta 
signal.jpg старт / signalwin.jpg выигрышь/ signallox.jpg проигрышь/
6.9 /reaktor (азартная)
reaktor.jpg старт / reaktorwin.jpg победа / reaktorlox.jpg проигрышь/ ты на ядерной станции у тебя 2 рычага остудить реактор реактор греется каждые 5 сек нажимая на охладить ты охлаждает его и продливаешь игру на рандомное время и уменьшает шанс взрыва но от твоего множетеля отнимается рандомно от 0.5x до 0.1x нажимая на греть то реактор нагревается и твой шанс взлететь на воздух и повторить историю Чернобыля растет в рандомно проценте и время игры сокращается тоже но но к твоему множителю растет от 1x до 5x и в любой момент можешь нажать на сброс охлаждения и игра завершается ты забираешь награду
6.10 /ten (честная)
ten.jpg старт / tenwin.jpg победа / tenlox.jpg -проигрыш/ ты идёшь по темному коридору к комнате с тайником и либо тебя ловит охрана либо тебя некто не ловит и чем ближе к комнате тем выше щанс а если дойти до комнаты это спустя 10 нажатий на кнопку идти вперёд то отправиться superwin.jpg и сумма умнажаеться на x10 /2 кнопки уйти забрав награду идти дальше повышать множетел и процент проигрыша 
6.11 /maths (честная)
maths.jpg старт игры
игрок решает примеры случайный пример по теме с 1 по 8 класс и 3 кнопки с вариантами ответа шанс на выигрыш большой так что даем игроку подумать 1 минуту и умножаем сумму на x1.5
чем быстрее и точнее — тем выше выигрыш
ошибка → проигрыш
победа: mathswin.jpg
проигрыш: mathslox.jpg
=========================
7. ЛОГИ
=========================
логировать:
победа / поражение
итоговую сумму
скрытый шанс
шаги
игрок:
НЕ ВИДИТ математику
=========================
8. ФИНАЛ
=========================
ОБЯЗАТЕЛЬНО:
пройтись по всему коду
найти скрытые баги:
не удаляющиеся сообщения
зависшие кнопки
двойные списания(пусть бот в логике сам тоже это ищет по возможности)
сверить ВСЕ команды с README.md
/help — только краткие описания
❌ не добавлять закулисье
❌ не объяснять механику игроку из закулисья только поверхность что известно из промта 
✅ стабильность
✅ визуал
✅ логика